{{- /*
  
  Required Parameters:
    Page: The page context.
    Gallery: The name of the gallery. This is required.
    Slides: The map of slide data.
  
  Optional Parameters:
    GridWidth: The number of grid cells per row.
    RowHeight: The height of each row.
    Fit: (contain or cover) The fit for images and videos.
    GalleryClass: Custom class to apply to the div.
    GalleryStyle: Custom style to apply to the div.
    LinkClass: Custom class to apply to all anchor tags.
    LinkStyle: Custom style to apply to all anchor tags.
    DescPosition: (bottom, top, left, right) Where all slides 
                  descriptions should be positioned.
    Effect: (zoom, fade, none) The animation effect all slide should use.
    Width: The custom width for all slides.
    Height: The custom height for all slides.
    Zoomable: Whether slides should be zoomable.
    Draggable: Whether slides should be draggable.
    VideoClass: Custom class to apply to all video tags.
    VideoStyle: Custom style to apply to all video tags.
    Loop: Whether link videos should loop.
    Autoplay: Whether link videos should be set to autoplay.
    Preload: Value for link video preload attributes.
    ImgClass: Custom class to apply to all img tags.
    ImgStyle: Custom style to apply to all img tags.
    PhotoWidth: Specifies a pixel width for a thumbnail image to be 
                fetched using the photos API. Default is undefined.
              
*/}}

{{- /* Check we have what we need to start */}}
{{- if (and .Page (and .Gallery .Slides)) }}

  {{- if not (.Page.Scratch.Get "plugin-lightbox.Parameters") -}}
    {{- partial "plugin-lightbox/load-parameters" .Page -}}
  {{- end -}}
  
  {{- $Parameters := .Page.Scratch.Get "plugin-lightbox.Parameters" -}}
    
  {{- $GalleryClass := $Parameters.Style.GalleryClassName -}}
  {{- with .GalleryClass -}}
  {{- $GalleryClass = printf "%s %s" $GalleryClass (delimit (apply (split . " ") 
                                                                   "anchorize" 
                                                                   ".") 
                                                            " ") -}}
  {{- end -}}
    
  {{- $GalleryStyle := "" -}}
    {{- with .GridWidth -}}
      {{- $GalleryStyle = printf "grid-template-columns: repeat(%v, 1fr);" . -}}
    {{- end -}}
    {{- with .RowHeight -}}
      {{- $GalleryStyle = printf "%sgrid-auto-rows: %s;" $GalleryStyle . -}}
    {{- end -}}
    {{- with .GalleryStyle | default $Parameters.Style.Gallery -}}
      {{- $GalleryStyle = printf "%s%s" $GalleryStyle . -}}
    {{- end -}}
    
    
<div 
  {{- with .Gallery }} id="{{ . | anchorize }}"{{ end -}}
  {{- with $GalleryClass }} class="{{ . }}"{{ end -}}
  {{- with $GalleryStyle }} style="{{ . | safeCSS }}"{{ end -}}>
  
  {{- /* Invoke the lightbox partial for each slide. */}}
  {{- range .Slides }}
    {{- partial "plugin-lightbox/lightbox.html" (merge $ .) }}  
  {{- end }}
</div>
  
{{- end -}}