{{/* Slide data must be passed as a string to use this shortcode */}}
{{ if .Get "slide-data" }}

{{ $slide_data := .Get "slide-data" }}

{{/* Unmarshall the data */}}
{{ if (not ($slide_data | reflect.IsSlice)) }}
{{ with transform.Unmarshal $slide_data }}
{{ $slide_data = . }}
{{ end }}
{{ end }}

{{ if ($slide_data | reflect.IsSlice) }}
{{/* Autolink mangles the data so scheme and host are parameterized */}}
{{ $scheme := .Get "scheme" }}
{{ $host := .Get "host" }}

{{/* Reconstruct the slide data if these have been set */}}
{{ if (and $scheme $host) }}

{{/* Establish key values for the slide data */}}
{{ $title_key := .Get "title_key" | default "title" }}
{{ $desc_key := .Get "desc_key" | default "description" }}
{{ $src_key := .Get "src_key" | default "src"  }}
{{ $width_key := .Get "width_key" | default "width"  }}
{{ $height_key := .Get "height_key" | default "height"  }}
{{ $thumb_src_key := .Get "thumb_src_key" | default "thumb" }}
{{ $desc_position_key := .Get "desc_position_key" | default "desc-position" }}

{{ $altered_data := slice }}

{{ range $slide_data }}

{{ $src := index . $src_key }}
{{ with $src }}{{ $src = printf "%s://%s" $scheme (path.Join $host $src) }}{{ end }}

{{ $thumb := index . $thumb_src_key }}
{{ with $thumb }}{{ $thumb = printf "%s://%s" $scheme (path.Join $host $thumb) }}{{ end }}

{{ $altered_data = $altered_data | append (dict $src_key $src $thumb_src_key $thumb "link_class" .link_class "link_style" .link_style "gallery" .gallery $title_key (index . $title_key) $desc_key (index . $desc_key) $desc_position_key (index . $desc_position_key) "type" .type "effect" .effect $width_key (index . $width_key) $height_key (index . $height_key) "zoomable" .zoomable "draggable" .draggable "sizes" .sizes "srcset" .srcset "video_class" .video_class "video_style" .video_style "loop" .loop "autoplay" .autoplay "preload" .preload "alt" .alt "img_class" .img_class "img_style" .img_style "photo_width" .photo_width) }}

{{ end }}

{{ $slide_data = $altered_data }}

{{ end }}

{{ partial "gallery.html" (dict "gallery" (.Get "gallery") "slide_data" (.Get "slide-data") "flex_wrap" (.Get "flex-wrap") "div_style" (.Get "div-style") "div_class" (.Get "div-class") "link_class" (.Get "link-class") "link_style" (.Get "link-style") "img_class" (.Get "img-class") "img_style" (.Get "img-style") "video_class" (.Get "video-class") "video_style" (.Get "video-style") "photo_width" (.Get "photo-width") "title_key" (.Get "title-key") "desc_key" (.Get "desc-key") "src_key" (.Get "src-key") "width_key" (.Get "width-key") "height_key" (.Get "height-key") "thumb_src_key" (.Get "thumb-src-key") "desc_position_key" (.Get "desc-position-key")) }}

{{ end }}
{{ end }}